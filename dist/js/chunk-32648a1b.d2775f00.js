(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-32648a1b"],{"0ba4":function(t,e,n){t.exports=n.p+"img/img_weapon.76447149.png"},"2b18":function(t,e,n){t.exports=n.p+"img/img_hand.cd9acc1c.png"},"317d":function(t,e,n){},"576b":function(t,e,n){},"5a88":function(t,e,n){t.exports=n.p+"img/img_body.b2c84633.png"},6062:function(t,e,n){"use strict";var a=n("6d61"),s=n("6566");a("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),s)},8336:function(t,e,n){t.exports=n.p+"img/img_head.c947a839.png"},"8a4a":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"blind-box-container"},[a("p-header"),a("div",{staticClass:"blind-box-content"},[a("div",{staticClass:"blind-box"},[t._m(0),a("div",{staticClass:"box-amount"},[a("div",{staticClass:"amount-minus amount-operator"},[a("div",{on:{click:function(e){return t.handleAmount("minus")}}})]),a("div",{staticClass:"amount-input"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.amount,expression:"amount"}],attrs:{type:"text"},domProps:{value:t.amount},on:{input:[function(e){e.target.composing||(t.amount=e.target.value)},t.handleAmount]}})]),a("div",{staticClass:"amount-plus amount-operator"},[a("div",{on:{click:function(e){return t.handleAmount("plus")}}})])]),t._m(1),a("div",{staticClass:"box-btn"},[t._v(" COMING SOON! ")])])]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.state,expression:"state"}],staticClass:"open-modal"},[t.state?a("div",{staticClass:"open-mask",on:{click:t.hideModal}}):t._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:1==t.state,expression:"state == 1"}],staticClass:"open-animation"},[a("video",{staticClass:"open-video",attrs:{id:"open-video",preload:"",src:n("9464")}})]),2==t.state?a("div",{staticClass:"open-result scroll-wrap"},[a("div",{staticClass:"close",on:{click:t.hideModal}}),a("div",{staticClass:"card-items scroll-wrap d-flex flex-wrap justify-center align-center"},t._l(t.units,(function(e,n){return a("div",{key:n,staticClass:"card-item",on:{click:t.rotateCard}},[a("div",{staticClass:"card-sides"},[a("div",{staticClass:"card-side card-front"}),a("div",{staticClass:"card-side card-back"},[a("p-card",{attrs:{item:e,type:"medium"}})],1)])])})),0)]):t._e()])],1)},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"box-img"},[a("img",{attrs:{src:n("a40d"),alt:""}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"box-price"},[a("div",{staticClass:"icon-busd"},[a("img",{attrs:{src:n("d909"),alt:""}})]),a("div",{staticClass:"price"},[t._v("29.9 BUSD")])])}],i=n("1da1"),c=n("5530"),o=(n("96cf"),n("e9c4"),n("ac1f"),n("5319"),n("d3b7"),n("159b"),n("4e827"),n("d1ad")),r=n("d230"),l=n("2f62"),u=n("dc40");function d(t){return Object(u["a"])({url:"unit",method:"post",data:{hash:t}})}var h=n("89cb"),m=n("dd70"),p=n("ed08"),f=n("3ee0"),g=f.Shop,v=g.address,b=g.abi,w=f.Hpt,A=w.address,C=w.abi,_=f.Ice,y=_.address,T=_.abi,x={name:"BlindBox",components:{PHeader:o["a"],PCard:r["a"]},data:function(){return{video:null,shopCTR:null,myTokenCTR:null,loading:!1,state:0,amount:1,units:[],price:10,MTAllowance:0,retry:0,maxRetry:3,needApprove:!1,rules:null}},computed:Object(c["a"])({},Object(l["c"])(["web3","currentAccount","rootAccount","MT","GT"])),created:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.shopCTR=new t.web3.eth.Contract(b,v),t.myTokenCTR=new t.web3.eth.Contract(C,A),t.goldCTR=new t.web3.eth.Contract(T,y),!Object(p["d"])("UNIT_CODE_RULE")){e.next=7;break}t.rules=Object(p["d"])("UNIT_CODE_RULE"),e.next=11;break;case 7:return e.next=9,t.getRules();case 9:t.rules=e.sent,Object(p["g"])("UNIT_CODE_RULE",JSON.stringify(t.rules));case 11:case"end":return e.stop()}}),e)})))()},mounted:function(){this.init()},methods:Object(c["a"])(Object(c["a"])({},Object(l["b"])(["setGT","setMT"])),{},{init:function(){this.initChainBalance(),this.initChainAllowance()},initChainBalance:function(){this.getGTBalance(),this.getMTBalance()},initChainAllowance:function(){this.getMTAllowance()},handleAmount:function(t){var e=parseInt(this.amount)||0;this.amount="minus"==t?e-1<0?0:e-1:"plus"==t?e+1>50?50:e+1:e>50?50:e},buyBlindBox:function(){this.loading||(this.rootAccount.isLoggedIn?this.checkAllowance()?this.checkBalance()?this.amount<=0?this.$message.showMessage("请填写正确的购买数量"):this.buy(this.amount):this.$message.showMessage("余额不足，请充值"):this.approve():this.$EventBus.$emit("showConnect"))},approve:function(){var t=this;this.loading=!0;var e=this.convertToWei(m["a"]);this.myTokenCTR.methods.approve(v,e).send({from:this.currentAccount}).on("transactionHash",(function(t){console.log("approve","正在执行智能合约",t)})).then((function(){t.loading=!1,t.MTAllowance=e,t.checkAllowance(),t.$message.showMessage("授权成功"),console.log("approve","合约执行成功")})).catch((function(e){t.loading=!1,t.$message.showMessage("授权失败，请重试"),console.log("approve",e)}))},buy:function(t){var e=this;this.loading=!0,this.shopCTR.methods.buy(t).send({from:this.currentAccount}).on("transactionHash",(function(t){console.log("buy","正在执行智能合约",t)})).then((function(t){console.log("buy",t),e.mint(t.transactionHash)})).catch((function(t){e.loading=!1,e.$message.showMessage("购买失败，请重试"),console.log("buy",t)}))},mint:function(t){var e=this;d(t).then((function(t){e.loading=!1,e.state=1,e.units=t.units,console.log(t)})).catch((function(n){console.log("mint",n),e.retry>=e.maxRetry?(e.loading=!1,e.state=0,e.$message.showMessage("打开失败")):(e.mint(t),e.retry++)}))},rotateCard:function(t){t.currentTarget.classList.add("active")},getGTBalance:function(){var t=this;this.goldCTR.methods.balanceOf(this.currentAccount).call().then((function(e){console.log("[wallet] my GT: ",e),t.setGT(e)}))},getMTBalance:function(){var t=this;this.myTokenCTR.methods.balanceOf(this.currentAccount).call().then((function(e){console.log("[wallet] my MT: ",e),t.setMT(e)}))},getMTAllowance:function(){var t=this;this.myTokenCTR.methods.allowance(this.currentAccount,v).call().then((function(e){console.log("[wallet] my MT allowance: ",e),t.MTAllowance=e,t.checkAllowance()}))},checkBalance:function(){return!(this.amount*this.price>this.convertToEther(this.MT))},checkAllowance:function(){var t=this.convertToEther(this.MTAllowance),e=this.amount*this.price;return this.needApprove=t<=0||t<e,!this.needApprove},convertToWei:function(t){return this.web3.utils.toWei(t+"","ether")},convertToEther:function(t){return this.web3.utils.fromWei(t+"","ether").replace(/^(.*\..{4}).*$/,"$1")},getRules:function(){return new Promise((function(t){Object(h["b"])().then((function(e){var n={};e.rule.forEach((function(t){var e=t.part,a=t.attrs,s={},i=0;a.sort((function(t,e){return t.sort-e.sort})).forEach((function(t){t.start=i,t.end=i+t.bit_num,s[t.attr_key]=t,i=t.end})),n[e]=s})),t(n)}))}))},hideModal:function(){this.state=0}}),watch:{amount:function(){this.checkAllowance()},state:function(t){var e=this;if(1==t){var n=document.querySelector("#open-video");n.play(),n.addEventListener("ended",(function(){e.state=2}))}}}},O=x,k=(n("977a"),n("2877")),R=Object(k["a"])(O,a,s,!1,null,"5d87e316",null);e["default"]=R.exports},9464:function(t,e,n){t.exports=n.p+"media/open_box.b9831b1a.mp4"},"977a":function(t,e,n){"use strict";n("317d")},a40d:function(t,e,n){t.exports=n.p+"img/img_box.593daabd.png"},afed:function(t,e,n){"use strict";n("576b")},d230:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"part-item",class:"quality"+t.item.quality+" "+t.type},[a("div",{staticClass:"part-detail",class:t.selectedUnits&&t.selectedUnits[t.item.part]&&t.selectedUnits[t.item.part].atomic==t.item.atomic?"active":""},[a("div",{staticClass:"part-profession"},[a("img",{attrs:{src:t.partImgs["profession"+t.item.profession],alt:""}})]),a("div",{staticClass:"part-pos"},[a("img",{attrs:{src:t.partImgs["part"+t.item.part],alt:""}})]),a("div",{staticClass:"part-img d-flex flex-column align-center justify-center"},[1==t.item.part?a("img",{attrs:{src:n("8336"),alt:""}}):t._e(),2==t.item.part?a("img",{attrs:{src:n("5a88"),alt:""}}):t._e(),3==t.item.part?a("img",{attrs:{src:n("2b18"),alt:""}}):t._e(),4==t.item.part?a("img",{attrs:{src:n("ea65"),alt:""}}):t._e(),5==t.item.part?a("img",{attrs:{src:n("0ba4"),alt:""}}):t._e()]),a("div",{staticClass:"part-attrs d-flex flex-column justify-center align-center",class:"quality"+t.item.quality},[t._l(t.attrs,(function(e,n){return[t.item[e]?a("div",{key:n,staticClass:"part-attr d-flex"},[a("img",{staticClass:"attr-icon",attrs:{src:t.partImgs[e],alt:""}}),a("div",{staticClass:"attr-name"},[t._v(t._s(t.attrMap[e]))]),a("div",{staticClass:"attr-value"},[t._v(t._s(t.item[e]))])]):t._e()]}))],2)])])},s=[],i=n("2909"),c=n("1da1"),o=(n("96cf"),n("e9c4"),n("d3b7"),n("159b"),n("4e827"),n("b64b"),n("6062"),n("3ca3"),n("ddb0"),n("ac1f"),n("5319"),n("89cb")),r=n("ed08"),l={name:"PCard",props:{item:{type:Object,default:null},selectedUnits:{type:Object,default:null},type:{type:String,default:"small"}},data:function(){return{partImgs:{},rules:null,attrs:[],attrMap:{blood:"生命力",attack_value:"攻击力",dodge:"闪避",hit:"命中",physical_defends:"装甲防御",magic_defends:"能量防御",reduce_harm_percent:"反伤(%)",reverse_harm_percent:"减伤(%)",attack_speed:"攻击速度",suck_blood:"吸血",critical_hit_rate:"暴击率(%)",critical_hit_effect:"暴击效果"}}},created:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.loadImgs(),!Object(r["d"])("UNIT_CODE_RULE")){e.next=5;break}t.rules=Object(r["d"])("UNIT_CODE_RULE"),e.next=9;break;case 5:return e.next=7,t.getRules();case 7:t.rules=e.sent,Object(r["g"])("UNIT_CODE_RULE",JSON.stringify(t.rules));case 9:t.attrs=t.getAttrs();case 10:case"end":return e.stop()}}),e)})))()},methods:{getRules:function(){return new Promise((function(t){Object(o["b"])().then((function(e){var n={};e.rule.forEach((function(t){var e=t.part,a=t.attrs,s={},i=0;a.sort((function(t,e){return t.sort-e.sort})).forEach((function(t){t.start=i,t.end=i+t.bit_num,s[t.attr_key]=t,i=t.end})),n[e]=s})),t(n)}))}))},getAttrs:function(){var t=[];for(var e in this.rules)t.push.apply(t,Object(i["a"])(Object.keys(this.rules[e])));return Object(i["a"])(new Set(t))},loadImgs:function(){var t=this,e=n("c84d");e.keys().forEach((function(e){n("b4c4")("./part"+e.replace(".","")).then((function(n){var a=/\.\/(.+)\.png/,s=a.exec(e)[1];t.$set(t.partImgs,s,n.default)}))}))}}},u=l,d=(n("afed"),n("2877")),h=Object(d["a"])(u,a,s,!1,null,"7b61c524",null);e["a"]=h.exports},d909:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABUBAMAAADuRQ3yAAAAHlBMVEUAAAD7twD/wgD/zAD8uAD8uAD/vwD8twD7uAD8twCQgxxOAAAACXRSTlMA0hUKW78UTNBowwOoAAABNklEQVRIx9XWMU7EMBRFUQSjLMBdumQHNPS01FR0swaopqNgAyNB4d2CUL5vhD+6aWY081o/HcXfseSb82UuW5u343HaitYKK2itsIbCKgprKKyisIbCKrqwe0UjX/eKRp4vAH3djO6YraFPtWxFOTJHK6yhsIrCGgqrKKyhsIZG3rvq4S8aeeyqu3/Qz67JqqCwig6sJ+jdfr39KKToQ1nPNBop+nKcQKOSo7UW0Ojk6OrI5radHP1JAV3Ytxxt7Ly6zSn6ywYabI4GG2iwPQo78p/k6MJ21QSlygekaKSwLUMnhuVoYx0N1tHGOhqso411tLGGkkFRoig5FXowlMyOMltFYR2FVRTWUVhFYR2FVRRWUdgPRYmh5LrQYRTUHqX+1FUW1FlQZUGdBVUW1FlQZUFPnm9IBcM1D5fcZQAAAABJRU5ErkJggg=="},ea65:function(t,e,n){t.exports=n.p+"img/img_leg.7613f29b.png"}}]);